<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>spring security讲义.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background-color: rgb(247, 247, 247); white-space: nowrap; }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left: 1px solid black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left: 1px solid silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; background: rgb(119, 238, 119); z-index: 1; }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-size: 1rem; font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left: 3px solid rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background: rgba(204, 204, 204, 0.2); }
.cm-s-typora-default .CodeMirror-gutters { border-right: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: "•"; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: " "; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: "↓"; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background: rgb(217, 217, 217); }
.CodeMirror-focused .CodeMirror-selected { background: rgb(215, 212, 240); }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}
.CodeMirror-lint-markers { width: 16px; }
.CodeMirror-lint-tooltip { background-color: infobackground; border: 1px solid black; border-radius: 4px; color: infotext; font-family: monospace; overflow: hidden; padding: 2px 5px; position: fixed; white-space: pre-wrap; z-index: 10000; max-width: 600px; opacity: 0; transition: opacity 0.4s; font-size: 0.8em; }
.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning { background-position: left bottom; background-repeat: repeat-x; }
.CodeMirror-lint-mark-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg=="); }
.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning { background-position: center center; background-repeat: no-repeat; cursor: pointer; display: inline-block; height: 16px; width: 16px; vertical-align: middle; position: relative; }
.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning { padding-left: 18px; background-position: left top; background-repeat: no-repeat; }
.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-multiple { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC"); background-repeat: no-repeat; background-position: right bottom; width: 100%; height: 100%; }


html { font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { background: rgb(181, 214, 252); text-shadow: none; }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; overflow-x: auto; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
#write li > table:first-child { margin-top: -20px; }
img { max-width: 100%; vertical-align: middle; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.footnotes { opacity: 0.8; font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: transparent; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { break-after: avoid-page; orphans: 2; }
  p { orphans: 4; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: monospace; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-print-anchor { border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; background: transparent !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }


@font-face { font-family: "Open Sans"; font-style: normal; font-weight: normal; src: local("Open Sans Regular"), url("./github/400.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: normal; src: local("Open Sans Italic"), url("./github/400i.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: bold; src: local("Open Sans Bold"), url("./github/700.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: bold; src: local("Open Sans Bold Italic"), url("./github/700i.woff") format("woff"); }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border-width: 0px 0px 1px; border-style: none none solid; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
#write { overflow-x: auto; }
table tr { border-top: 1px solid rgb(204, 204, 204); background-color: white; margin: 0px; padding: 0px; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) { 
}
@media print { 
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
#md-notification::before { top: 10px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.117647); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }






</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><h1><a name='header-c1' class='md-header-anchor '></a>SpringSecurity</h1><p></p><h2><a name='header-c8' class='md-header-anchor '></a>SpringSecurity简介</h2><p>Spring Security 提供了基于javaEE的企业应有软件全面的安全服务。这里特别强调支持使用SPring框架构件的项目，Spring框架是企业软件开发javaEE方案的领导者。如果你还没有使用Spring来开发企业应用程序，我们热忱的鼓励你仔细的看一看。熟悉Spring特别是依赖注入原理两帮助你更快更方便的使用Spring Security。</p><p>人们使用Spring Secruity的原因有很多，单大部分都发现了javaEE的Servlet规范或EJB规范中的安全功能缺乏典型企业应用场景所需的深度。提到这些规范，重要的是要认识到他们在WAR或EAR级别无法移植。因此如果你更换服务器环境，这里有典型的大量工作去重新配置你的应用程序员安全到新的目标环境。使用Spring Security 解决了这些问题，也为你提供许多其他有用的，可定制的安全功能。</p><p>正如你可能知道的两个应用程序的两个主要区域是“认证”和“授权”（或者访问控制）。这两个主要区域是Spring Security 的两个目标。“认证”，是建立一个他声明的主题的过程（一个“主体”一般是指用户，设备或一些可以在你的应用程序中执行动作的其他系统）。“授权”指确定一个主体是否允许在你的应用程序执行一个动作的过程。为了抵达需要授权的店，主体的身份已经有认证过程建立。这个概念是通用的而不只在Spring Security中。</p><p>在身份验证层，Spring Security 的支持多种认证模式。这些验证绝大多数都是要么由第三方提供，或由相关的标准组织，如互联网工程任务组开发。另外Spring Security 提供自己的一组认证功能。具体而言，Spring Security 目前支持所有这些技术集成的身份验证：</p><ul><li>HTTP BASIC 认证头 (基于 IETF RFC-based 标准)</li><li>HTTP Digest 认证头 ( IETF RFC-based 标准)</li><li>HTTP X.509 客户端证书交换 ( IETF RFC-based 标准)</li><li>LDAP (一个非常常见的方法来跨平台认证需要, 尤其是在大型环境)</li><li>Form-based authentication (用于简单的用户界面)</li><li>OpenID 认证</li><li>Authentication based on pre-established request headers (such as Computer Associates Siteminder) 根据预先建立的请求有进行验证</li><li>JA-SIG Central Authentication Service (CAS，一个开源的SSO系统 )</li><li>Transparent authentication context propagation for Remote Method Invocation (RMI) and HttpInvoker (Spring远程协议)</li><li>Automatic &quot;remember-me&quot; authentication (你可以勾选一个框以避免预定的时间段再认证)</li><li>Anonymous authentication (让每一个未经验证的访问自动假设为一个特定的安全标识)</li><li>Run-as authentication (在一个访问应该使用不同的安全标识时非常有用)</li><li>Java Authentication and Authorization Service (JAAS)</li><li>JEE container autentication (所以如果愿你以可以任然使用容器管理的认证)</li><li>Kerberos</li><li>Java Open Source Single Sign On (JOSSO) *</li><li>OpenNMS Network Management Platform *</li><li>AppFuse *</li><li>AndroMDA *</li><li>Mule ESB *</li><li>Direct Web Request (DWR) *</li><li>Grails *</li><li>Tapestry *</li><li>JTrac *</li><li>Jasypt *</li><li>Roller *</li><li>Elastic Path *</li><li>Atlassian Crowd *</li><li>Your own authentication systems (see below)</li><li>表示由第三方提供</li></ul><p>很多独立软件供应商，因为灵活的身份验证模式二选择Spring Security。这样做允许他们快速的集成到他们的终端客户需求的解决方案而不用进行大量工程或者改变客户的环境。如果上面的验证机制不符合你的需求，Spring Security 是一个开放的平台，要实现你 自己的验证机制检查。Spring Security 的许多企业用户需要与不遵循任何安全标准的“遗留”系统集成，Spring Security可以很好的与这类系统集成。</p><p>无论何种身份验证机制，Spring Security提供一套的授权功能。这里有三个主要的热点区域，授权web请求、授权方法是否可以被调用和授权访问单个域对象的实例。为了帮助让你分别了解这些差异，认识在Servlet规范网络模式安全的授权功能，EJB容器管理的安全性和文件系统的安全。Spring Security在这些重要的区域提供授权功能，我们将在手册后面进行介绍。</p><h3><a name='header-c112' class='md-header-anchor '></a> </h3><h2><a name='header-c113' class='md-header-anchor '></a>SpringSecurity原理</h2><p>首先，权限管理离不开登陆验证的，所以登陆验证拦截器AuthenticationProcessingFilter要讲；还有就是对访问的资源管理吧，所以资源管理拦截器AbstractSecurityInterceptor要讲；但拦截器里面的实现需要一些组件来实现，所以就有了AuthenticationManager、accessDecisionManager等组件来支撑。</p><p>现在先大概过一遍整个流程，用户登陆，会被AuthenticationProcessingFilter拦截，调用AuthenticationManager的实现，而且AuthenticationManager会调用ProviderManager来获取用户验证信息（不同的Provider调用的服务不同，因为这些信息可以是在数据库上，可以是在LDAP服务器上，可以是xml配置文件上等），如果验证通过后会将用户的权限信息封装一个User放到spring的全局缓存SecurityContextHolder中，以备后面访问资源时使用。</p><p>访问资源（即授权管理），访问url时，会通过AbstractSecurityInterceptor拦截器拦截，其中会调用FilterInvocationSecurityMetadataSource的方法来获取被拦截url所需的全部权限，在调用授权管理器AccessDecisionManager，这个授权管理器会通过spring的全局缓存SecurityContextHolder获取用户的权限信息，还会获取被拦截的url和被拦截url所需的全部权限，然后根据所配的策略（有：一票决定，一票否定，少数服从多数等），如果权限足够，则返回，权限不够则报错并调用权限不足页面。</p><h2><a name='header-c120' class='md-header-anchor '></a>项目模块组成</h2><p>在 Spring Security 3.0, 代码库被分割到单独的jar，这样可以更清楚的分隔不用功能区域和第三方依赖。如果你使用Maven构建你的项目，那么这些都是需要你添加到你的<code>pom.xml</code>中的. 甚至你没有使用Maven，我们建议你请求<code>pom.xml</code>文件来获取第三方依赖和版本。另一个好办法是检查实例应用程序的库。</p><h5><a name='header-c123' class='md-header-anchor '></a>核心模块 - spring-security-core.jar</h5><p>包含核心的验证和访问控制类和接口，远程支持和基本的配置API。任何使用Spring Security的应用程序都需要这个模块。支持独立应用程序、远程客户端、服务层方法安全和JDBC用户配置。包含以下顶层包:</p><ul><li><code>org.springframework.security.core</code></li><li><code>org.springframework.security.access</code></li><li><code>org.springframework.security.authentication</code></li><li><code>org.springframework.security.provisioning</code></li></ul><h5><a name='header-c139' class='md-header-anchor '></a>远程调用 - spring-security-remoting.jar</h5><p>提供与Spring Remoting的集成，通常你不需要这个模块，除非你挣使用Spring Remoting编写远程客户端。主要的包是<code>org.springframework.security.remoting</code>.</p><h5><a name='header-c142' class='md-header-anchor '></a>网页 - spring-security-web.jar</h5><p>包括锅炉汽和网站安全相关的基础代码。使用Servlet API的任何应用依赖他。如果你需要Spring Security网页验证服务和基于URL的访问控制你需要这个模块。主包名为 <code>org.springframework.security.web</code>.</p><h5><a name='header-c145' class='md-header-anchor '></a>配置 - spring-security-config.jar</h5><p>包含安全命令空间的解析代码。如果你使用Spring Security XML命令空间进行配置你需要包含这个模块。 主包名为<code>org.springframework.security.config</code>. 没有类需要被应用程序直接使用.</p><h5><a name='header-c148' class='md-header-anchor '></a>LDAP - spring-security-ldap.jar</h5><p>LDAP验证和配置代码，如果你需要使用LDAP验证和管理LDAP用户实体，你需要这个模块。主包名为<code>org.springframework.security.ldap</code>.</p><h5><a name='header-c151' class='md-header-anchor '></a>ACL访问控制表 - spring-security-acl.jar</h5><p>ACL专门的领域对象的实现。用来在你的应用程序中应用安全特定的领域对象实例。主包名为<code>org.springframework.security.acls</code>.</p><h5><a name='header-c154' class='md-header-anchor '></a>CAS - spring-security-cas.jar</h5><p>Spring Security的CAS客户端集成。如果你想用CAS的SSO服务器使用Spring Security网页验证需要该模块。顶层的包是<code>org.springframework.security.cas</code>.</p><h5><a name='header-c157' class='md-header-anchor '></a>OpenID - spring-security-openid.jar</h5><p>OpenID 网页验证支持。使用外部的OpenID服务器验证用户。 <code>org.springframework.security.openid</code>. 需要 OpenID4Java.</p><h5><a name='header-c160' class='md-header-anchor '></a>Test - spring-security-test.jar</h5><p>支持Spring Security的测试。</p><h4><a name='header-c163' class='md-header-anchor '></a>签出源代码</h4><p>因为Spring Security是一个开源项目，我们强烈建议您使用Git签出源代码。这可以让你完全访问所有势力应用程序，你可以轻松地构建最先进的最新版本的项目。有了项目的源代码对debug有非常大的帮助。异常堆栈跟踪不再是模糊的黑盒问题，你可以沿着他找出到底发生了什么。源代码是中级文档，通常也是最简答的项目实际是如何工作的地方。</p><p>要获取项目源代码，请使用一下git命令:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>git clone https://github.com/spring-projects/spring-security.git</pre><p>这可以让你在本地机器上访问到整个项目的历史记录（包括所有版本和分支）.</p><h2><a name='header-c171' class='md-header-anchor '></a>快速入门</h2><h3><a name='header-c172' class='md-header-anchor '></a>本例所覆盖的内容：</h3><ol start='' ><li>使用Spring Security管理用户身份认证、登录退出</li><li>用户密码加密及验证</li><li>获取登录用户信息。</li><li>使用Spring Security管理url和权限</li></ol><p></p><h3><a name='header-c188' class='md-header-anchor '></a>本例所使用的框架</h3><ol start='' ><li>Spring boot</li><li>Spring MVC</li><li>Spring Security</li><li>Spring Data JPA</li><li>thymeleaf</li></ol><p>参考链接：</p><h3><a name='header-c207' class='md-header-anchor '></a>项目搭建</h3><p>创建SpringBoot WEB工程</p><p>1.创建工程</p><p> security web Thymeleaf JPA </p><p>2.配置数据源</p><p>​	pom.xml</p><pre class='md-fences mock-cm' style='display:block;position:relative'>	&lt;dependency&gt;
		&lt;groupId&gt;mysql&lt;/groupId&gt;
		&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
	&lt;/dependency&gt;</pre><p>​	application.properties</p><pre class='md-fences mock-cm' style='display:block;position:relative'>spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.mode=HTML5
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.content-type=text/html
spring.thymeleaf.cache=false

spring.datasource.url=jdbc:mysql://127.0.0.1:3306/demo1?useUnicode=true&amp;characterEncoding=utf-8
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driverClassName=com.mysql.jdbc.Driver
#Springboot jpa \u89E3\u51B3Mysql8\u5C0F\u65F6\u95EE\u9898
spring.datasource.test-on-borrow=false
spring.datasource.test-while-idle=true
spring.datasource.time-between-eviction-runs-millis= 3600000
spring.application.name=@project.description@

#spring.jpa.hibernate.persistenceXmlLocation=classpath:META-INF/persistence-mysql.xml
spring.jpa.hibernate.ddl-auto=update
spring.jpa.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect
#spring.jpa.hibernate.dialect=org.hibernate.dialect.SQLServerdialect
spring.jpa.show-sql=true

#multipart.maxFileSize=-1
#multipart.maxRequestSize=-1

management.security.role=ADMIN
management.context-path=/manage
security.ignored[0]=/css/*
security.ignored[1]=/js/**
security.ignored[2]=/images/*
security.ignored[3]=/fonts/**
security.ignored[4]=/**/favicon.ico
security.ignored[5]=/**/**.png
security.ignored[6]=webjars/**
info.app.name=app
info.app.version=1.0.0

spring.messages.basename=messages
spring.messages.cacheSeconds=-1
spring.messages.encoding=UTF-8
</pre><p>​	</p><p>3.配置thymeleaf</p><p>Thymeleaf缓存在开发过程中，肯定是不行的，那么就要在开发的时候把缓存关闭，只需要在application.properties进行配置即可：</p><p>spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.mode=HTML5
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.content-type=text/html
spring.thymeleaf.cache=false</p><h4><a name='header-c235' class='md-header-anchor '></a>run</h4><p></p><p></p><h3><a name='header-c240' class='md-header-anchor '></a>基础的网站安全java配置</h3><p>第一步是创建我们的java配置。这个配置在你的应用程序中创建一个springSecurityFilterChain 的Servlet的过滤器<code>springSecurityFilterChain</code>负责所有安全（例如 保护应用程序的URL，验证提交的用户名和密码，重定向到登陆的表单等等）。你可以在下面找到大部分java配置项的例子:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>import org.springframework.beans.factory.annotation.Autowired;

import org.springframework.context.annotation.*;
import org.springframework.security.config.annotation.authentication.builders.*;
import org.springframework.security.config.annotation.web.configuration.*;

@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

	@Autowired
	public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
		auth
			.inMemoryAuthentication()
				.withUser(&quot;user&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;);
	}
}</pre><table><thead><tr><th>**</th><th>configureGlobal方法的名字不重要，然而，重要的是只在一个被<code>@EnableWebSecurity</code>,<code>@EnableGlobalMethodSecurity</code>，或者<code>@EnableGlobalAuthentication</code>注解的类中配置AuthenticationManagerBuilder，否则会有不可预知的后果。</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><p>第二步</p><pre class='md-fences mock-cm' style='display:block;position:relative'>protected void configure(HttpSecurity http) throws Exception {
	http
		.authorizeRequests()
			.anyRequest().authenticated()
			.and()
		.formLogin()
			.and()
		.httpBasic();
}</pre><p>上面的默认配置:</p><ul><li>确保我们应用中的所有请求都需要用户被认证</li><li>允许用户进行基于表单的认证</li><li>允许用户使用HTTP基于验证进行认证</li></ul><h4><a name='header-c266' class='md-header-anchor '></a>run</h4><h3><a name='header-c267' class='md-header-anchor '></a>Java配置和表单登录</h3><p>你可能会想知道系统提示您登录表单从哪里来的，因为我们都没有提供任何的HTML或JSP文件。由于Spring Security的默认配置并没有明确设定一个登录页面的URL，Spring Security自动生成一个，基于这个功能被启用，使用默认URL处理登录的提交内容，登录后跳转的URL等等。</p><p>自动生成的登录页面可以方便应用的快速启动和运行，大多数应用程序都需要提供自己的登录页面。要做到这一点，我们可以更新我们的配置，如下所示：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>protected void configure(HttpSecurity http) throws Exception {
	http
		.authorizeRequests()
			.anyRequest().authenticated()
			.and()
		.formLogin()
			.loginPage(&quot;/login&quot;) 
			.permitAll();        
}</pre><table><thead><tr><th>**</th><th>指定登录页的路径</th></tr></thead><tbody><tr><td>**</td><td>我们必须允许所有用户访问我们的登录页（例如为验证的用户），这个<code>formLogin().permitAll()</code>方法允许基于表单登录的所有的URL的所有用户的访问。</td></tr></tbody></table><h3><a name='header-c280' class='md-header-anchor '></a>自定义登录页面</h3><h4><a name='header-c281' class='md-header-anchor '></a>登录页面</h4><p>查看源文件，细微更改</p><h4><a name='header-c284' class='md-header-anchor '></a>run</h4><h4><a name='header-c285' class='md-header-anchor '></a>美化页面</h4><p>1.样式依赖</p><pre class='md-fences mock-cm' style='display:block;position:relative'>	&lt;dependency&gt;
		&lt;groupId&gt;org.webjars&lt;/groupId&gt;
		&lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
		&lt;version&gt;3.2.0&lt;/version&gt;
	&lt;/dependency&gt;</pre><p>2.增加页面样式，并修改片段</p><pre class='md-fences mock-cm' style='display:block;position:relative'>&lt;!DOCTYPE html &gt;
&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
&lt;title&gt;Login&lt;/title&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;&lt;/meta&gt;
&lt;link rel=&quot;stylesheet&quot;
	th:href=&quot;@{/webjars/bootstrap/3.2.0/css/bootstrap.min.css}&quot;
	href=&quot;/webjars/bootstrap/2.3.2/css/bootstrap.min.css&quot; /&gt;
&lt;/head&gt;
&lt;style&gt;
&lt;!--
body {
	padding-top: 20px;
}
--&gt;
&lt;/style&gt;
&lt;body onload=&quot;document.form.username.focus();&quot;&gt;
	&lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt;
		&lt;div class=&quot;container-fluid&quot;&gt;
			&lt;div class=&quot;navbar-header&quot;&gt;
				&lt;a class=&quot;navbar-brand&quot; href=&quot;#&quot;&gt;**系统登录&lt;/a&gt;
			&lt;/div&gt;
		&lt;/div&gt;
	&lt;/nav&gt;
	&lt;div class=&quot;container&quot;&gt;
		&lt;div class=&quot;row&quot;&gt;
			&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;
				&lt;div class=&quot;panel panel-default&quot;&gt;
					&lt;div class=&quot;panel-heading&quot;&gt;
						&lt;h3 class=&quot;panel-title&quot;&gt;Please sign in&lt;/h3&gt;
					&lt;/div&gt;
					&lt;div class=&quot;panel-body&quot;&gt;
						&lt;form name=&quot;form&quot; action=&quot;login&quot; method=&quot;POST&quot;&gt;
							&lt;fieldset&gt;
								&lt;div class=&quot;form-group&quot;&gt;
									&lt;input class=&quot;form-control&quot; placeholder=&quot;username&quot;
										name=&quot;username&quot; type=&quot;text&quot; /&gt;
								&lt;/div&gt;
								&lt;div class=&quot;form-group&quot;&gt;
									&lt;input class=&quot;form-control&quot; placeholder=&quot;Password&quot;
										name=&quot;password&quot; type=&quot;password&quot; value=&quot;&quot; /&gt;
								&lt;/div&gt;
								&lt;div class=&quot;checkbox&quot;&gt;
									&lt;label&gt; &lt;input name=&quot;remember&quot; type=&quot;checkbox&quot;
										value=&quot;Remember Me&quot; /&gt; Remember Me
									&lt;/label&gt;
								&lt;/div&gt;
								&lt;input class=&quot;btn btn-lg btn-success btn-block&quot; type=&quot;submit&quot;
									value=&quot;Login&quot; /&gt; &lt;input type=&quot;hidden&quot;
									th:name=&quot;${_csrf.parameterName}&quot; th:value=&quot;${_csrf.token}&quot;
									th:if=&quot;${_csrf}&quot; /&gt;
							&lt;/fieldset&gt;
						&lt;/form&gt;
						&lt;div th:if=&quot;${session.SPRING_SECURITY_LAST_EXCEPTION!=null}&quot;&gt;
						&lt;div class=&quot;alert alert-danger alert-dismissable&quot;&gt;
							&lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot;
								aria-hidden=&quot;true&quot;&gt;&times;&lt;/button&gt;
							&lt;span th:text=&quot;${session.SPRING_SECURITY_LAST_EXCEPTION}&quot; &gt;&lt;/span&gt;
						&lt;/div&gt;
						&lt;input type=&quot;hidden&quot; th:name=&quot;${_csrf.parameterName}&quot;
							th:value=&quot;${_csrf.token}&quot; th:if=&quot;${_csrf}&quot; /&gt;
					&lt;/div&gt;
					&lt;/div&gt;
				&lt;/div&gt;
			&lt;/div&gt;
		&lt;/div&gt;
	&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</pre><h4><a name='header-c292' class='md-header-anchor '></a>run</h4><h3><a name='header-c293' class='md-header-anchor '></a>403解决</h3><p>http.csrf().disable();</p><pre class='md-fences mock-cm' style='display:block;position:relative'>跨站请求伪造也被成为单击攻击或者会话叠置，简称CSRF或者XSRF。是一种恶意利用从网站信任用户获取未授权命令的行为。和跨站脚本(XSS)不同，XSS利用的是特定站点信任的用户，而CSRF利用的是用户浏览器中信任的站点。
历史

CSRF漏洞从2001年开始被人知道并在某些情况下被人利用。因为它是在用户IP地址之外执行的，一些站点日志可能没有记录CSRF的证据，所以这种漏洞极少被公开报道过，直到2007年，才有一些证据确凿的例子：

在线银行[ING Direct](ING Group)的web应用遭受CSRF攻击，允许非法转账。
知名的视频网站YouTube2008年也遭受过CSRF攻击，允许攻击者几乎可以执行任何用户操作。
2008年年初墨西哥的一个银行客户被email中的图片tag攻击。图片tag中的链接改变了银行ADSL路由上的DNS条目，指向了一个恶意的冒充银行网站。
McAfee被CSRF攻击，允许攻击者更改他们公司的电脑系统。

示例和特征

如果攻击者可以找到一个可复制的链接，当受害者登陆的时候，在目标页面执行特定的动作，他们就可以在他们控制的页面嵌入这些链接，诱使受害者打开这些链接。攻击者可能会把链接放在受害者登陆站点时既有可能访问的地方，或者在邮件体内，邮件附件里面。uTorrent曾发现过一个真实的CSRF漏洞，它的web控制台允许通过localhost:8080访问，可以通过简单的get请求执行一些关键任务：

强制下载一个.torrent文件

http://localhost:8080/gui/?action=add-url&amp;s=http://evil.example.com/backdoor.torrent

修改uTorrent的管理员密码

http://localhost:8080/gui/?action=setsetting&amp;s=webui.password&amp;v=eviladmin
攻击者可以把恶意自动执行代码放到论坛的image标签中或者垃圾邮件中，当用户打开浏览器访问这些页面时，会自动执行恶意代码。如果用户使用的是容易被攻击的uTorrent版本，那么在打开这些带有恶意代码的页面时，就很容易受到攻击。

![](http://localhost:8080/gui/?action=add-url&amp;s=http://evil.example.com/backdoor.torrent)
CSRF攻击使用image标签伪造主要来自网络论坛，因为论坛允许上传图片，但不支持js,例如可以使用BBCode:

[img]http://localhost:8080/gui/?action=add-url&amp;s=http://evil.example.com/backdoor.torrent[/img]
当攻击连接执行example.com时，浏览器可以自动发送example.com域下存在的任何cookies到服务端，当攻击发生时，用户已经登录了这个网站，此时CSRF攻击就可以利用特定漏洞，执行特殊行为。
CSRF是利用浏览器发起的代理人攻击。
以下是CSRF常用特征：

涉及网站依赖用户身份认证
利用身份认证获取网站信任
欺骗用户浏览器发送HTTP请求到目标站点
涉及的HTTP请求都有副作用

web应用程序的风险就是执行行为是基于信任和授权的用户输入，而不需要用户授权特殊的行为。一个通过浏览器cookie授权的用户可能会不知觉的发送HTTP请求到信任该用户的网站，然后引起不知情的行为。
在上面的例子中，uTorrent的web接口支持GET请求进行临界状态改变操作(修改证书，下载文件等)促进了攻击，GET请求改变状态这种行为在RFC16规范中是不推荐的：

GET和HEAD方法不应该有其它行为除了用来获取数据，这些方法应该被认为是安全的。允许用户代理使用其它方法，例如POST，PUT和DELETE，这样用户才能清楚的知道这个请求是一个不安全的行为。

根据这个假定，许多存在CSRF防御机制的web框架将不会支持GET请求，但是不是仅通过HTTP方法，更多的是关注状态的改变。
伪造登陆请求

攻击者可以伪造请求利用攻击者的认证登陆目标站点，这也成为CSRF登陆。CSRF登陆制造了多种新奇的攻击可能，例如，攻击者可以稍后利用他自己的有效凭证登陆站点，浏览保存在账号中的活动页面上的隐私信息。
HTTP方法和CSRF

不同的HTTP请求方法有不同难易程度的CSRF攻击，也需要不同等级的防护措施，因为浏览器处理不同请求方法的方式不同。

使用HTTP GET方法进行CSRF攻击是很容易的，使用上文提到的方法，例如一个简单的包含多个参数的超链接，利用image标签自动加载。然而根据HTTP规范，GET方法应该是一个安全方法，不能明显的用于更改用户状态。应用如果需要这种操作应该使用HTTP POST方法或者使用反CSRF保护。
HTTP POST方法对CSRF也有不同难易程度的攻击方法，主要依赖详细的使用场景：
1.对于简单的将POST数据编码为查询字符串的方式，使用HTML表单进行CSRF攻击是十分简单的，这时必须使用反CSRF的防护措施；
2. 如果数据以其他格式(JSON，XML)发送,一个标准的方法是使用XMLHttpRequest进行的POST的请求，这种方式同源策略和跨站资源共享可以阻止CSRF攻击；有一种技术可以利用一个简单的HTML表单发送任意内容，那就是使用ENCTYPE属性；这样可以利用text/plain内容属性区分伪造的请求和合法的请求，但是如果服务器没有强制这种机制，CSRF攻击仍会发生。
其他的HTTP方法(PUT,DELETE等)可以只通过使用XMLHttpRequest的同源策略和跨站资源共享阻止CSRF攻击，但是一旦站点设置了Access-Control-Allow-Origin: *头，这种方法就没用了。

CSRF的局限性

成功的CSRF需要一些前提条件：

1.攻击者的目标站点不能有检查referrer头的操作，或者被攻击者的浏览器允许referrer欺骗

2.攻击者必须在目标站点找到一个表单提交入口，或者有类似作用的URL(例如可以用来转移钱，修改受害者邮件地址或者密码)。
3.攻击者必须决定所有表单或者URL参数中正确的值；如果存在秘密的身份验证值或者ID，攻击者没有猜到话，攻击有很大可能不会成功(除非攻击者足够幸运，什么都猜对)。
4.攻击者必须诱使受害者访问有恶意代码的页面，并且此时受害者已经登录到目标站点。

注意CSRF攻击是盲目的，攻击者不知道目标站点会给受害者的伪造请求返回何种响应，除非攻击者可以利用跨站脚本或者目标站点的其他缺陷。同样的，如果后续的链接或者表单同样是可以预测的，那么攻击可以把任意最初请求之后的链接或者表单当成目标(多个目标可以通过在一个页面包含多个image来模拟或者使用js增加点击之间的延迟)。
由于上面的这些限制，攻击者可能很难找到登录的受害者或者可以攻击的表单提交。从另一方面来说，攻击尝试对受害者来说很容易实施并且不可见，程序设计者可能对CSRF攻击不太熟悉，也没有做好准备相比于密码破解字典攻击。
预防措施

大多数CSRF预防技术都是通过在请求中加入验证数据来区分请求是否来自未授权位置。
同步token模式
这种技术就是为每个请求生成一个私密的唯一的token,web程序会在所有的表单中嵌入这个token，然后在服务端验证。token可以用任何方法创建，但是要确保不可预测和唯一性。这样的话攻击者就不能再他们的请求中使用一个正确的token来验证请求的合法性。
Django框架在html表单中使用的一个例子：

&lt;input type=&quot;hidden&quot; name=&quot;csrfmiddlewaretoken&quot; value=&quot;KbyUmhTLMpYj7CD2di7JKP1P3qmLlkPt&quot; /&gt;
由于只依赖HTML，所以这种方法是最具兼容性的，但是也给服务端带来了一定的复杂度，因为服务端要承担校验每个请求的token以确定请求有效性的任务。token是唯一且不可预测的，还需要执行适当的事件序列，带了可用性问题。可以通过使用session CSRF token来代替使用每个请求的CSRF token来降低复杂度。同时，很难让web应用大量使用AJAX。
Cookie-to-Header Token
web应用使用js来进行大量的操作，可以依赖同源策略使用反CSRF技术：

在登录的时候，web应用把一个随机的token塞到cookie中，并且把同样的token保存在整个用户session中；
Set-Cookie: Csrf-token=i8XNjC4b8KVok4uw5RftR38Wgp2BFwql; expires=Thu, 23-Jul-2015 10:25:33 GMT; Max-Age=31449600; Path=/

客户端的js读取到cookie中的token值，把它放在每个事务请求头中；
X-Csrf-Token: i8XNjC4b8KVok4uw5RftR38Wgp2BFwql

服务端验证token的完整性；

这种技术的安全性主要依赖于只有同源下的js才能访问到cookie值这样的假定。流氓文件和email中的js不能读取cookie,然后把cookie中的token放到header中，尽管cookie中的csrf-token会随伪造请求一起发送，但是服务端仍然会检查请求头中是否有有效的X-Csrf-Token。
CSRF token应该是唯一的和不可预测的。它可以随机产生，或者利用HMAC算法根据session token派生出来。

csrf_token = HMAC(session_token, application_secret)
cookie中的CSRF token设计的时候，必须可以被js读取到。
这项技术已经被许多现代框架实现，例如Django和AngularJS。因为token在整个用户会话期间保持一致，所以在ajax应用中也可以很好的工作，但是不会执行web应用中的事件序列。
客户端安全措施
浏览器插件例如Firefox的RequestPolicy插件，或者Chrome，Firefox的uMatrix插件，都可以通过提供一个默认禁止跨站请求策略来阻止CSRF。然而，当时这样可能显著的影响了一些站点的正常操作。Firefox的CsFire插件通过移除跨站请求中身份验证信息的方式，可以缓解CSRF的影响，同时最低限度影响正常浏览。
Firefox的NoScript插件也可以减轻CSRF的威胁通过下面的方式：区分可信和不可信站点；移除授权信息；负载不信任站点发往信任站点的POST请求。NoScript中Application Boundary Enforcer模块可以阻止网页发往本地站点(localhost)的请求，阻止本地服务的CSRF，例如上文提到的uTorrent漏洞。
Firefox的cookie自我销毁插件不会直接阻止CSRF，但是可以减少攻击窗口，通过用户切换tab页时立即删除tab页cookie的方式。
其他技术
历史上使用过的或提出的各种其他阻止CSRF的技术：

验证请求头中是否包含X-Requested-With，或者检查HTTP的Referer头或者Origin头。然而这种方式也是不安全的 —— 利用浏览器插件和重定向就可以让攻击者在请求中添加自定义的HTTP头，然后就可以允许跨域请求了。
对于嵌入式网络设备来说通过检查HTTP的Referer头的方式来确定请求是否来自授权页面是一种常用方法，因为这样不会增加内存需要。然后一个请求如果省略了Referer头，会被当成未授权的，因为攻击者可以屏蔽Referer头，然后通过FTP或者HTTPS发送请求。这种严格的Referer检查可能会导致一个问题就是浏览器或者代理由于隐私原因忽略Referer头。旧版本的Flash允许恶意Flash利用CRLF Injection生成任意HTTP头的GET或者POST请求。客户端的CRLF Injection漏洞可以被用来欺骗HTTP请求中的Referer头。
利用URL参数的POST请求一段时间以来被当做是预防轻微CSRF攻击的方法。然而，如今POST和其他HTTP方法都可以利用XMLHttpRequest执行。

跨站脚本漏洞允许攻击者绕过大多数CSRF防御措施，但是带有附件认证信息和验证码验证的方法仍然是有效的。
</pre><h4><a name='header-c297' class='md-header-anchor '></a>run</h4><p></p><h1><a name='header-c300' class='md-header-anchor '></a>登录及特殊访问控制</h1><h2><a name='header-c301' class='md-header-anchor '></a>获取当前用户信息</h2><p>0。增加配置文件</p><pre class='md-fences mock-cm' style='display:block;position:relative'>&lt;dependency&gt;
			&lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;
			&lt;artifactId&gt;thymeleaf-extras-springsecurity4&lt;/artifactId&gt;
		&lt;/dependency&gt;</pre><p>1.从页面上显示当前登陆的用户名</p><p><a href='html%C2%A0xmlns:th=%22http://www.thymeleaf.org%22%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0xmlns:sec=%22http://www.thymeleaf.org/thymeleaf-extras-springsecurity4%22' target='_blank' >html xmlns:th="http://www.thymeleaf.org"      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"</a><!-- Thymeleaf为我们提供的Spring Security的标签支持 --><head>    <meta content="text/html;charset=UTF-8"/>    <title sec:authentication="name"></title> <!-- 获得当前用户的用户名 --></p><p> </p><p>2.如果想在程序中获得当前登陆用户对应的对象。</p><p>UserDetails userDetails = (UserDetails) SecurityContextHolder.getContext()    .getAuthentication()    .getPrincipal();</p><p> </p><p>3.如果想获得当前登陆用户所拥有的所有权限。</p><p>GrantedAuthority[] authorities = userDetails.getAuthorities();</p><p> </p><p>3.4.基于Thymeleaf 获得当前用户</p><p><span th:text="|${#authentication.name},您好|">您好</span></p><p> </p><h2><a name='header-c329' class='md-header-anchor '></a>基于表达式的访问控制</h2><h3><a name='header-c330' class='md-header-anchor '></a>通过表达式控制URL权限</h3><p> Spring Security允许我们在定义URL访问或方法访问所应有的权限时使用Spring EL表达式，在定义所需的访问权限时如果对应的表达式返回结果为true则表示拥有对应的权限，反之则无。Spring Security可用表达式对象的基类是SecurityExpressionRoot，其为我们提供了如下在使用Spring EL表达式对URL或方法进行权限控制时通用的内置表达式。</p><table><thead><tr><th>表达式</th><th>描述</th></tr></thead><tbody><tr><td>hasRole([role])</td><td>当前用户是否拥有指定角色。</td></tr><tr><td>hasAnyRole([role1,role2])</td><td>多个角色是一个以逗号进行分隔的字符串。如果当前用户拥有指定角色中的任意一个则返回true。</td></tr><tr><td>hasAuthority([auth])</td><td>等同于hasRole</td></tr><tr><td>hasAnyAuthority([auth1,auth2])</td><td>等同于hasAnyRole</td></tr><tr><td>Principle</td><td>代表当前用户的principle对象</td></tr><tr><td>authentication</td><td>直接从SecurityContext获取的当前Authentication对象</td></tr><tr><td>permitAll</td><td>总是返回true，表示允许所有的</td></tr><tr><td>denyAll</td><td>总是返回false，表示拒绝所有的</td></tr><tr><td>isAnonymous()</td><td>当前用户是否是一个匿名用户</td></tr><tr><td>isRememberMe()</td><td>表示当前用户是否是通过Remember-Me自动登录的</td></tr><tr><td>isAuthenticated()</td><td>表示当前用户是否已经登录认证成功了。</td></tr><tr><td>isFullyAuthenticated()</td><td>如果当前用户既不是一个匿名用户，同时又不是通过Remember-Me自动登录的，则返回true。</td></tr></tbody></table><p> </p><p> </p><h3><a name='header-c377' class='md-header-anchor '></a>通过表达式控制方法权限</h3><p>​	   使用@PreAuthorize和@PostAuthorize进行访问控制</p><p>  使用@PreFilter和@PostFilter进行过滤</p><h3><a name='header-c382' class='md-header-anchor '></a>使用hasPermission表达式</h3><p> </p><h3><a name='header-c385' class='md-header-anchor '></a>Thymeleaf + Spring Security</h3><p> </p><p><a href='http://projects.spring.io/spring-security/' target='_blank' >http://projects.spring.io/spring-security/</a></p><p></p><p> </p><h2><a name='header-c394' class='md-header-anchor '></a>带权限登录控制</h2><p>1.首先当我们要自定义Spring Security的时候我们需要继承自WebSecurityConfigurerAdapter来完成，相关配置重写对应 方法即可。 
2.我们在这里注册CustomUserService的Bean，然后通过重写configure方法添加我们自定义的认证方式。 
3.在configure(HttpSecurity http)方法中，我们设置了登录页面，而且登录页面任何人都可以访问，然后设置了登录失败地址，也设置了注销请求，注销请求也是任何人都可以访问的。 
4.permitAll表示该请求任何人都可以访问，.anyRequest().authenticated(),表示其他的请求都必须要有权限认证。 
5.这里我们可以通过匹配器来匹配路径，比如antMatchers方法，假设我要管理员才可以访问admin文件夹下的内容，我可以这样来写：.antMatchers(&quot;/admin/<strong>&quot;).hasRole(&quot;ROLE_ADMIN&quot;)，也可以设置admin文件夹下的文件可以有多个角色来访问，写法如下：.antMatchers(&quot;/admin/</strong>&quot;).hasAnyRole(&quot;ROLE_ADMIN&quot;,&quot;ROLE_USER&quot;) 
6.可以通过hasIpAddress来指定某一个ip可以访问该资源,假设只允许访问ip为210.210.210.210的请求获取admin下的资源，写法如下.antMatchers(&quot;/admin/**&quot;).hasIpAddress(&quot;210.210.210.210&quot;) 
7.更多的权限控制方式参看下表： 
<img src='file:////tmp/wps-chixue/ksohtml/wpsiEUOCB.jpg' alt='img' /> 
8.这里我们还可以做更多的配置，参考如下代码：</p><p>http.authorizeRequests()                .anyRequest().authenticated()                .and().formLogin().loginPage(&quot;/login&quot;)                //设置默认登录成功跳转页面                .defaultSuccessUrl(&quot;/index&quot;).failureUrl(&quot;/login?error&quot;).permitAll()                .and()                //开启cookie保存用户数据                .rememberMe()                //设置cookie有效期                .tokenValiditySeconds(60 * 60 * 24 * 7)                //设置cookie的私钥                .key(&quot;&quot;)                .and()                .logout()                //默认注销行为为logout，可以通过下面的方式来修改                .logoutUrl(&quot;/custom-logout&quot;)                //设置注销成功后跳转页面，默认是跳转到登录页面                .logoutSuccessUrl(&quot;&quot;)                .permitAll();</p><p> </p><h2><a name='header-c409' class='md-header-anchor '></a>匿名登录控制</h2><p>http.authorizeRequests()	.filterSecurityInterceptorOncePerRequest(true)//过滤器的安全拦截器的每一次的要求.antMatchers(&quot;/login&quot;).permitAll()    </p><p>// for test			.antMatchers(&quot;/403&quot;).permitAll()    // for test</p><p></p><h1><a name='header-c416' class='md-header-anchor '></a>保护方法应用</h1><h1><a name='header-c417' class='md-header-anchor '></a>1.使用注解保护方法</h1><p>在Spring Security中实现方法级安全性的最常见办法是使用特定的注解，将这些注解应用到需要保护的方法上。这样有几个好处，最重要的是当我们在编辑器中查看给定的方法时，能够很清楚地看到它的安全规则。 
Spring Security提供了三种不同的安全注解：</p><ul><li>Spring Security自带的@Security注解</li><li>JSR-250的@RolesAllowed注解</li><li>表达式驱动的注解，包括@PreAuthorize，@PostAuthorize，@PreFilter，@PostFilter。</li></ul><h2><a name='header-c431' class='md-header-anchor '></a>1.1使用@Secured注解限制方法调用</h2><p>在Spring中，如果要启用基于注解的方法安全性，关键之处在于要在配置类上使用@EnableGlobalMethodSecurity：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>@Configuration
@EnableGlobalMethodSecurity(securedEnabled=true)
public class MethodSecurityConfig extends GlobalMethodSecurityConfiguration{

}</pre><blockquote><p>GlobalMethodSecurityConfiguration类能够为方法级别的安全性提供更精细的配置。 
如果securedEnabled属性的值为true的话，将会创建一个切点，这样的话Spring Security切面就会包装带有@Security注解的方法。（所以最好把要控制权限的方法放在service层）。</p></blockquote><p>示例：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>@Service
public class SecurityService {
    @Secured(&quot;ROLE_ADMIN&quot;)
    public void test1(){
        System.out.println(&quot;拥有ADMIN权限&quot;);
    }

    @Secured({&quot;ROLE_ADMIN&quot;,&quot;ROLE_USER&quot;})
    public void test2(){
        System.out.println(&quot;拥有ADMIN或USER权限&quot;);
    }
}
12345678910111213</pre><p>@Secured注解的不足之处在于它是spring特定的注解。如果更倾向于使用Java标准定义的注解，那么你应该考虑使用@RolesAllowed注解</p><h2><a name='header-c444' class='md-header-anchor '></a>1.2在Spring Security中使用JSR-250的@RolesAllowed注解</h2><p>@RolesAllowed是JSR-250定义的Java标准注解。如果选择@RolesAllowed的话，需要将@EnableGlobalMethodSecurity的jsr250Enabled属性设置为true，以开启此功能：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>@Configuration
@EnableGlobalMethodSecurity(securedEnabled=true,jsr250Enabled=true)
public class MethodSecurityConfig extends GlobalMethodSecurityConfiguration{

}12345</pre><p>使用示例：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>@Service
public class SecurityService {
    @RolesAllowed(&quot;ROLE_ADMIN&quot;)
    public void test1(){
        System.out.println(&quot;拥有ADMIN权限&quot;);
    }

    @RolesAllowed({&quot;ROLE_ADMIN&quot;,&quot;ROLE_USER&quot;})
    public void test2(){
        System.out.println(&quot;拥有ADMIN或USER权限&quot;);
    }
}123456789101112</pre><h1><a name='header-c451' class='md-header-anchor '></a>2.使用表达式实现方法级别的安全性</h1><p>Spring Security 3.0提供了4个新的注解，可以使用SpEL表达式来保护方法调用</p><table><thead><tr><th>注解</th><th>描述</th></tr></thead><tbody><tr><td>@PreAuthorize</td><td>在方法调用之前，基于表达式的计算结果来限制对方法的访问</td></tr><tr><td>@PostAuthorize</td><td>允许方法调用，但是如果表达式计算结果为false，将抛出一个安全性异常</td></tr><tr><td>@PostFilter</td><td>允许方法调用，但必须按照表达式来过滤方法的结果</td></tr><tr><td>@PreFilter</td><td>允许方法调用，但必须在进入方法之前过滤输入值</td></tr></tbody></table><p>首先，我们需要将@EnableGlobalMethodSecurity的prePostEnabled属性值设为true，从而开启它们：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>@Configuration
@EnableGlobalMethodSecurity(securedEnabled=true,jsr250Enabled=true,prePostEnabled=true)
public class MethodSecurityConfig extends GlobalMethodSecurityConfiguration{

}12345</pre><h2><a name='header-c473' class='md-header-anchor '></a>2.1表述方法访问规则</h2><p>@PreAuthorize和@PostAuthorize能够基于表达式的计算结果来限制方法的访问。区别在于表达式执行的时机。@PreAuthorize的表达式会在方法调用之前执行，如果表达式的计算结果不为true的话，将会阻止方法执行。与之相反，@PostAuthorize的表达式知道方法返回才会执行，然后根据结果决定是否抛出安全性异常，如果为false，会抛出一个AccessDeniedException异常，而调用者也得不到返回的值。</p><pre class='md-fences mock-cm' style='display:block;position:relative'>@Service
public class SecurityService {
    @PreAuthorize(&quot;hasRole(&#39;ROLE_ADMIN&#39;) and #num &gt; 5&quot;)
    public void test1(int num){
        System.out.println(&quot;拥有ADMIN权限并且输入的数字大于5&quot;);
    }

    @PostAuthorize(&quot;returnObject == &#39;abc&#39;&quot;)
    public String test2(){
        System.out.println(&quot;执行方法并返回一个字符串对象&quot;);
        return &quot;abcd&quot;;
    }
}12345678910111213</pre><blockquote><p>为了便利地访问受保护方法的返回对象，Spring Security在SpEL中提供了名为returnObject的变量。</p></blockquote><h2><a name='header-c480' class='md-header-anchor '></a>2.2 过滤方法的输入和输出</h2><p>@PostFilter和@PreFilter都使用一个SpEL作为值参数，但是这个表达式不是用来限制方法访问的，@PostFilter会使用这个表达式计算该方法所返回集合的每个成员，将计算结果为false的成员从结果集中除掉，返回结果集。而@PreFilter过滤的是要进入方法中的集合，同样会对每一条数据进行检查，只有满足表达式（即表达式返回true）的结果才能保留在集中，最终传到方法里面。</p><pre class='md-fences mock-cm' style='display:block;position:relative'>@Service
public class SecurityService {
    /**
     * 需要拥有ADMIN或USER权限才能访问，
     * ADMIN缺陷的话返回所有数据，
     * USER权限的话只返回和登录用户相同用户名的数据
     * @return
     */
    @PreAuthorize(&quot;hasAnyRole({&#39;ROLE_ADMIN&#39;,&#39;ROLE_USER&#39;})&quot;)
    @PostFilter(&quot;hasRole(&#39;ROLE_ADMIN&#39;) || &quot;
            + &quot;filterObject.username == principal.username&quot;)
    public List&lt;User&gt; test1(){
        User u1 = new User(&quot;xuexiaoqiang&quot;);
        User u2 = new User(&quot;admin&quot;);
        User u3 = new User(&quot;xueqiang&quot;);
        List&lt;User&gt; list = new ArrayList&lt;User&gt;();
        list.add(u1);
        list.add(u2);
        list.add(u3);
        return list;
    }

    /**
     * 需要拥有ADMIN或USER权限才能访问，
     * 拥有ADMIN权限的用户会将数据全部传入方法中
     * 拥有USER权限的用户只会将相同用户名的数据传进去
     * @param users
     */
    @PreAuthorize(&quot;hasAnyRole({&#39;ROLE_ADMIN&#39;,&#39;ROLE_USER&#39;})&quot;)
    @PreFilter(&quot;hasRole(&#39;ROLE_ADMIN&#39;) || &quot;
            + &quot;filterObject.username == principal.username&quot;)
    public void test2(List&lt;User&gt; users){
        for(User u : users){
            System.out.println(u.getUsername());
        }
    }
}
1234567891011121314151617181920212223242526272829303132333435363738</pre><blockquote><p>filterObject对象引用的是传入或传出的List中的某一个元素。</p></blockquote><p></p><h3><a name='header-c489' class='md-header-anchor '></a>参考</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>http://www.thymeleaf.org/doc/articles/springsecurity.html

https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/

https://springcloud.cc/spring-security-zhcn.html#cors</pre><p></p><p></p></div>
</body>
</html>